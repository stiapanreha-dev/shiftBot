# Telegram Shift Tracking Bot

## –û–ø–∏—Å–∞–Ω–∏–µ –ü—Ä–æ–µ–∫—Ç–∞

–¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç –¥–ª—è —É—á–µ—Ç–∞ —Ä–∞–±–æ—á–∏—Ö —Å–º–µ–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–ø–∏—Å—å—é –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets, —Å–∏—Å—Ç–µ–º–æ–π —Ä–∞–Ω–≥–æ–≤ –∏ –±–æ–Ω—É—Å–æ–≤.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

```
Alex12060/
‚îú‚îÄ‚îÄ bot.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ config.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ .env
‚îú‚îÄ‚îÄ handlers.py               # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π
‚îú‚îÄ‚îÄ keyboards.py              # Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ sheets_service.py         # Google Sheets API
‚îú‚îÄ‚îÄ rank_service.py           # –°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–≥–æ–≤ –∏ –±–æ–Ω—É—Å–æ–≤
‚îú‚îÄ‚îÄ time_utils.py             # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏/–≤—Ä–µ–º–µ–Ω–µ–º
‚îÇ
‚îú‚îÄ‚îÄ docs/                     # üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ tests/                    # üß™ –¢–µ—Å—Ç—ã (integration, unit, utils)
‚îú‚îÄ‚îÄ scripts/                  # üìú –°–∫—Ä–∏–ø—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ dev/                  # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ run_tests.sh              # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ requirements.txt          # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env                      # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ google_sheets_credentials.json
```

–°–º. [README.md](../README.md) –¥–ª—è –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞.

---

## –û—Å–Ω–æ–≤–Ω–æ–π –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ–Ω—ã
1. –í—ã–±–æ—Ä –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞ (Server date -1 / Server date)
2. –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ (–∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ 3√ó4 —Å AM/PM)
3. –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è (–¥–∞—Ç–∞ = —Ç–µ–∫—É—â–∞—è —Å–µ—Ä–≤–µ—Ä–Ω–∞—è)
4. –í—ã–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
5. –í–≤–æ–¥ —Å—É–º–º—ã –∑–∞—Ä–∞–±–æ—Ç–∫–∞ —Å –ø—Ä–æ–¥—É–∫—Ç–∞
6. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –µ—â–µ –ø—Ä–æ–¥—É–∫—Ç—ã ("Add model")
7. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ID (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)
8. –†–∞—Å—á–µ—Ç Total sales, Net sales, Total made
9. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–Ω–≥–æ–≤
10. –í—ã–¥–∞—á–∞ –±–æ–Ω—É—Å–æ–≤ –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–Ω–≥–æ–≤
11. –í—ã–≤–æ–¥ —Å–≤–æ–¥–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Google Sheets

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–º–µ–Ω—ã
- –ü—Ä–æ—Å–º–æ—Ç—Ä 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–º–µ–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ Date)
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Clock in, Clock out, Total sales
- –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞—Ç–∞ –±–µ—Ä–µ—Ç—Å—è –∏–∑ –ø–æ–ª—è Date –∑–∞–ø–∏—Å–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º—ã—Ö –ø–æ–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–Ω–≥–æ–≤ –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–≥–æ–≤
- **6 —Ä–∞–Ω–≥–æ–≤:** Rookie ‚Üí Hustler ‚Üí Closer ‚Üí Shark ‚Üí King of Greed ‚Üí Chatting God
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ/–ø–æ–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Å—è—á–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–º–µ–Ω–µ —Ä–∞–Ω–≥–∞
- –°–ª—É—á–∞–π–Ω—ã–µ –±–æ–Ω—É—Å—ã –∑–∞ –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ä–∞–Ω–≥–∞
- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–∞–Ω–≥–æ–≤

### –ë–æ–Ω—É—Å—ã
- **flat_immediate** - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫ —Ç–µ–∫—É—â–µ–π —Å–º–µ–Ω–µ
- **percent_next** - —É–≤–µ–ª–∏—á–µ–Ω–∏–µ % –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å–º–µ–Ω–µ
- **double_commission** - —É–¥–≤–æ–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å–º–µ–Ω–µ
- **percent_prev** - –±–æ–Ω—É—Å –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å–º–µ–Ω—ã –¥—Ä—É–≥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- **percent_all** - –±–æ–Ω—É—Å –æ—Ç –≤—Å–µ—Ö —Å–º–µ–Ω –∑–∞ –¥–µ–Ω—å
- **paid_day_off** - –æ–ø–ª–∞—á–∏–≤–∞–µ–º—ã–π –≤—ã—Ö–æ–¥–Ω–æ–π
- **telegram_premium** - –ø–æ–¥–ø–∏—Å–∫–∞ Telegram Premium

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –¢–µ–∫—É—â–∏–π —Ä–∞–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- Total sales –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
- Total made —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ pay day
- –î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ pay day

### –ù–∞–≤–∏–≥–∞—Ü–∏—è
- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
- –°—Ç–µ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤–æ–∑–≤—Ä–∞—Ç–∞

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
- **–§–æ—Ä–º–∞—Ç:** `YYYY/MM/DD HH:MM:SS`
- **–¢–∞–π–º–∑–æ–Ω–∞:** America/New_York (UTC-5 —Å —É—á–µ—Ç–æ–º DST)
- **–ü—Ä–∏–º–µ—Ä:** `2025/10/15 14:30:00`

### Google Sheets
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã (–ª–∏—Å—Ç Shifts):**
| ID | Date | EmployeeId | EmployeeName | Clock in | Clock out | Model A | Model B | Model C | Total sales | Net sales | Total made |

**–ü–æ–ª—è:**
- `ID` - –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç
- `Date` - —Å–µ—Ä–≤–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–º–µ–Ω—ã
- `EmployeeId` - Telegram user ID
- `EmployeeName` - Telegram username
- `Clock in` - –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Å–º–µ–Ω—ã (–≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
- `Clock out` - –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–º–µ–Ω—ã (–≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
- `Model X` - —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ –ø—Ä–æ–¥—É–∫—Ç—É X
- `Total sales` - —Å—É–º–º–∞ –≤—Å–µ—Ö –ø—Ä–æ–¥–∞–∂
- `Net sales` - Total sales √ó (1 - COMMISSION_RATE)
- `Total made` - Net sales √ó PAYOUT_RATE

### –†–∞—Å—á–µ—Ç—ã
```python
Total sales = sum(Model A, Model B, Model C, ...)
Net sales = Total sales √ó (1 - COMMISSION_RATE)
Total made = Net sales √ó PAYOUT_RATE
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:
- COMMISSION_RATE = 0.20 (20%)
- PAYOUT_RATE = 1.00 (100%)

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –°—Ç–µ–∫

- **Python:** 3.8+
- **python-telegram-bot:** 21.x (ConversationHandler, FSM)
- **gspread:** 6.1.2 (Google Sheets API)
- **pytz:** 2024.1 (—Ä–∞–±–æ—Ç–∞ —Å —Ç–∞–π–º–∑–æ–Ω–∞–º–∏)
- **python-dotenv:** 1.0.1 (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

**–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- Type hints –≤–µ–∑–¥–µ
- Docstrings –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ try/except
- –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:**

| –ú–æ–¥—É–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|--------|----------|----------------|
| `bot.py` | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, ConversationHandler |
| `handlers.py` | –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ | –õ–æ–≥–∏–∫–∞ FSM, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ |
| `keyboards.py` | –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è InlineKeyboard |
| `sheets_service.py` | Google Sheets | CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏, —Ä–∞—Å—á–µ—Ç—ã |
| `rank_service.py` | –°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–≥–æ–≤ | –õ–æ–≥–∏–∫–∞ —Ä–∞–Ω–≥–æ–≤ –∏ –±–æ–Ω—É—Å–æ–≤ |
| `time_utils.py` | –í—Ä–µ–º—è | –†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏/–≤—Ä–µ–º–µ–Ω–µ–º |
| `config.py` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ .env |

**–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏:**

| –ö–∞—Ç–∞–ª–æ–≥ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------|
| `docs/` | –í—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ |
| `tests/` | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã |
| `scripts/dev/` | –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –û–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
# Telegram Bot
BOT_TOKEN=your_bot_token_here

# Google Sheets
GOOGLE_SA_JSON=google_sheets_credentials.json
SPREADSHEET_ID=your_spreadsheet_id
SHEET_NAME=Shifts

# Products (comma-separated)
PRODUCTS=Model A,Model B,Model C

# Rates
COMMISSION_RATE=0.20
PAYOUT_RATE=1.00

# Time (true = fixed UTC-5 without DST)
USE_FIXED_UTC_MINUS_5=true
```

## –°–æ—Å—Ç–æ—è–Ω–∏—è FSM

```python
START                 # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
CHOOSE_DATE_IN       # –í—ã–±–æ—Ä –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞
CHOOSE_TIME_IN       # –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞
CHOOSE_TIME_OUT      # –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è
PICK_PRODUCT         # –í—ã–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞
ENTER_AMOUNT         # –í–≤–æ–¥ —Å—É–º–º—ã
ADD_OR_FINISH        # –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å
EDIT_MENU            # –ú–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
EDIT_PICK_SHIFT      # –í—ã–±–æ—Ä —Å–º–µ–Ω—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
EDIT_FIELD           # –í—ã–±–æ—Ä –ø–æ–ª—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
EDIT_DATE_IN         # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã Clock in
EDIT_TIME_IN         # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ Clock in
EDIT_TIME_OUT        # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ Clock out
EDIT_TOTAL_SALES     # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Total sales
```

## –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã

### –í—ã–±–æ—Ä –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞ —Å–º–µ–Ω—ã
```
[Server date - 1]
[Server date]
[‚¨ÖÔ∏è Back]
```

### –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ (AM)
```
[12 AM] [1 AM] [2 AM] [3 AM]
[4 AM]  [5 AM] [6 AM] [7 AM]
[8 AM]  [9 AM] [10 AM] [11 AM]
[‚Üí PM]
[‚¨ÖÔ∏è Back]
```

### –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ (PM)
```
[12 PM] [1 PM] [2 PM] [3 PM]
[4 PM]  [5 PM] [6 PM] [7 PM]
[8 PM]  [9 PM] [10 PM] [11 PM]
[‚Üí AM]
[‚¨ÖÔ∏è Back]
```

### –í—ã–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞
```
[Model A] [Model B] [Model C]
[‚¨ÖÔ∏è Back]
```

### Add model / Finish
```
[Add model]
[Finish shift]
[‚¨ÖÔ∏è Back]
```

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - –≤—ã–±–æ—Ä –ø–æ–ª—è
```
[Clock in]
[Clock out]
[Total sales]
[‚¨ÖÔ∏è Back]
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è
1. **–í—Ä–µ–º—è:** Clock out –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–∑–∂–µ Clock in
2. **–°—É–º–º—ã:** –¢–æ–ª—å–∫–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞, –ø–∞—Ä—Å–∏–Ω–≥ —Å —Ç–æ—á–∫–æ–π –∏ –∑–∞–ø—è—Ç–æ–π
3. **–î—É–±–ª–∏–∫–∞—Ç—ã:** –ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å –æ–¥–∏–Ω –ø—Ä–æ–¥—É–∫—Ç –¥–≤–∞–∂–¥—ã

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Try/except –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å Google Sheets
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª—å

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç
**–í–∞–∂–Ω–æ:** –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ Clock in:
- –î–∞—Ç–∞ –±–µ—Ä–µ—Ç—Å—è –∏–∑ –ø–æ–ª—è Date –∑–∞–ø–∏—Å–∏ (–Ω–µ —Ç–µ–∫—É—â–∞—è!)
- –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –≤—ã–±–æ—Ä: "Date of record -1" / "Date of record"
- Clock out —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞—Ç—É –∏–∑ Date –∑–∞–ø–∏—Å–∏

### –°—Ç–µ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–π "–ù–∞–∑–∞–¥"
```python
# –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –Ω–æ–≤—ã–π —à–∞–≥
push_state(context, new_state)

# –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ù–∞–∑–∞–¥"
prev_state = go_back(context)
```

## üöÄ –ó–∞–ø—É—Å–∫

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
pip install -r requirements.txt
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Sheets
1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ Google Cloud Console
2. –í–∫–ª—é—á–∏—Ç—å Google Sheets API
3. –°–æ–∑–¥–∞—Ç—å Service Account
4. –°–∫–∞—á–∞—Ç—å JSON credentials ‚Üí `google_sheets_credentials.json`
5. –°–æ–∑–¥–∞—Ç—å Google —Ç–∞–±–ª–∏—Ü—É
6. –î–∞—Ç—å –¥–æ—Å—Ç—É–ø Service Account (email –∏–∑ credentials)
7. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É: `python3 scripts/dev/init_sheets.py`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env
```bash
nano .env  # –°–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å
```

–ü—Ä–∏–º–µ—Ä `.env`:
```env
BOT_TOKEN=your_bot_token_here
SPREADSHEET_ID=your_spreadsheet_id
GOOGLE_SA_JSON=google_sheets_credentials.json
PRODUCTS=Model A,Model B,Model C
COMMISSION_RATE=0.20
PAYOUT_RATE=1.00
USE_FIXED_UTC_MINUS_5=true
```

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
```bash
python3 bot.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets
python3 scripts/dev/check_sheets.py

# –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
python3 scripts/dev/add_test_data.py
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã:
```bash
./run_tests.sh
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç:
```bash
python3 tests/integration/test_scenario_2_1.py
python3 tests/integration/test_scenario_2_2.py
```

### –£—Ç–∏–ª–∏—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
# –£–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–º–µ–Ω—ã
python3 tests/utils/delete_shifts.py 11 12 13

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–º–µ–Ω—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è
python3 tests/utils/check_today_shifts.py
```

**–ü–æ–¥—Ä–æ–±–Ω–µ–µ:** [tests/README.md](../tests/README.md)

---

## üìú –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (—Å–æ–∑–¥–∞—Ç—å —Å–º–µ–Ω—É / —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å / —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ / —Ä–∞–Ω–≥–∏)

## –ü—Ä–∏–º–µ—Ä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`
2. –í—ã–±–∏—Ä–∞–µ—Ç "Server date" –¥–ª—è –Ω–∞—á–∞–ª–∞ —Å–º–µ–Ω—ã
3. –í—ã–±–∏—Ä–∞–µ—Ç –≤—Ä–µ–º—è "9 AM"
4. –í—ã–±–∏—Ä–∞–µ—Ç –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è "5 PM"
5. –í—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç "Model A"
6. –í–≤–æ–¥–∏—Ç —Å—É–º–º—É "150.00"
7. –ù–∞–∂–∏–º–∞–µ—Ç "Add model"
8. –í—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç "Model B"
9. –í–≤–æ–¥–∏—Ç —Å—É–º–º—É "200.00"
10. –ù–∞–∂–∏–º–∞–µ—Ç "Finish shift"
11. –í–∏–¥–∏—Ç —Å–≤–æ–¥–∫—É:
    ```
    ‚úÖ –°–º–µ–Ω–∞ —Å–æ–∑–¥–∞–Ω–∞

    üìã ID —Å–º–µ–Ω—ã: 42
    üìÖ –î–∞—Ç–∞: 2025/10/15 18:30:00
    üë§ –°–æ—Ç—Ä—É–¥–Ω–∏–∫: username

    ‚è∞ –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:
       ‚Ä¢ –ù–∞—á–∞–ª–æ: 2025/10/15 09:00:00
       ‚Ä¢ –û–∫–æ–Ω—á–∞–Ω–∏–µ: 2025/10/15 17:00:00

    üí∞ –ü—Ä–æ–¥–∞–∂–∏:
       ‚Ä¢ Model A: 150.00
       ‚Ä¢ Model B: 200.00

    üíµ –ò—Ç–æ–≥–∏:
       ‚Ä¢ Total sales: 350.00
       ‚Ä¢ Net sales: 280.00
       ‚Ä¢ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: 280.00
    ```

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. –ù–µ—Ç Redis - —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å PicklePersistence)
2. –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç ID –Ω–µ –∞—Ç–æ–º–∞—Ä–µ–Ω (–¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω—É–∂–µ–Ω Google Apps Script)
3. –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ (–ª—é–±–æ–π –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞)
4. –ù–µ—Ç webhook —Ä–µ–∂–∏–º–∞ (—Ç–æ–ª—å–∫–æ polling)

## üõ†Ô∏è –°–∫—Ä–∏–ø—Ç—ã –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

–í –∫–∞—Ç–∞–ª–æ–≥–µ `scripts/dev/` –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã:

| –°–∫—Ä–∏–ø—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `init_sheets.py` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Google Sheets |
| `check_sheets.py` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets |
| `add_test_data.py` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| `demo_rank_bonus.py` | –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Ä–∞–Ω–≥–æ–≤ –∏ –±–æ–Ω—É—Å–æ–≤ |
| `populate_employee_ranks.py` | –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–Ω–≥–æ–≤ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ |
| `test_calculations.py` | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–æ–≤ |
| `test_complex_bonuses.py` | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ |
| `test_percent_prev_scenario.py` | –¢–µ—Å—Ç percent_prev –±–æ–Ω—É—Å–∞ |
| `verify_percent_prev.py` | –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è percent_prev |

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python3 scripts/dev/init_sheets.py
python3 scripts/dev/check_sheets.py
python3 scripts/dev/add_test_data.py
```

---

## TODO / –í–æ–∑–º–æ–∂–Ω—ã–µ –£–ª—É—á—à–µ–Ω–∏—è

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úÖ
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–≥–æ–≤ (6 —É—Ä–æ–≤–Ω–µ–π)
- ‚úÖ –ë–æ–Ω—É—Å—ã –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–≤–∫–∞ –∫–æ–º–∏—Å—Å–∏–∏
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (2/28)
- ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–æ—Ç–∞—Ü–∏–µ–π
- ‚úÖ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ üîÑ
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (26/28)
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
- [ ] CI/CD pipeline (GitHub Actions)

### –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è üìã
- [ ] –î–æ–±–∞–≤–∏—Ç—å PicklePersistence –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (ALLOWED_USERS)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /help
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /cancel
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç ID —á–µ—Ä–µ–∑ Google Apps Script
- [ ] Webhook —Ä–µ–∂–∏–º –≤–º–µ—Å—Ç–æ polling
- [ ] Dashboard –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤ –≤ PDF

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### Code Style
- PEP 8 (black formatter)
- PEP 257 (docstrings)
- Type hints –≤–µ–∑–¥–µ
- –ö—Ä–∞—Ç–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —Å —Ä–æ—Ç–∞—Ü–∏–µ–π.

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```python
# bot.py
from logging.handlers import RotatingFileHandler

def setup_logging():
    """Configure logging to file and console with rotation."""
    formatter = logging.Formatter(
        "%(asctime)s - %(name)s - %(levelname)s - %(message)s",
        datefmt="%Y-%m-%d %H:%M:%S"
    )

    # File handler with rotation (10MB, keep 5 backups)
    file_handler = RotatingFileHandler(
        "bot.log",
        maxBytes=10 * 1024 * 1024,  # 10 MB
        backupCount=5,
        encoding="utf-8"
    )
    file_handler.setLevel(logging.INFO)
    file_handler.setFormatter(formatter)

    root_logger.addHandler(console_handler)
    root_logger.addHandler(file_handler)
```

**–§–∞–π–ª –ª–æ–≥–æ–≤:**
- –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: `bot.log` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10 MB
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ backup —Ñ–∞–π–ª–æ–≤: 5 (bot.log.1, bot.log.2, ..., bot.log.5)
- –ö–æ–¥–∏—Ä–æ–≤–∫–∞: UTF-8

**–§–æ—Ä–º–∞—Ç—ã —Å–æ–±—ã—Ç–∏–π:**
–ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞:

| –ü—Ä–µ—Ñ–∏–∫—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|---------|----------|--------|
| `[START]` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∞–ª —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º | `User 120962578 (@username) started bot` |
| `[CREATE]` | –ù–∞—á–∞—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ–Ω—ã | `User 120962578 started shift creation` |
| `[DATE]` | –í—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞ | `User 120962578 selected date: 2025/10/15 (offset: 0)` |
| `[TIME_IN]` | –í—ã–±—Ä–∞–Ω–æ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ | `User 120962578 selected Clock in: 2025/10/15 09:00:00` |
| `[TIME_OUT]` | –í—ã–±—Ä–∞–Ω–æ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è | `User 120962578 selected Clock out: 2025/10/15 17:00:00` |
| `[PRODUCT]` | –í—ã–±—Ä–∞–Ω –ø—Ä–æ–¥—É–∫—Ç | `User 120962578 selected product: Model A` |
| `[AMOUNT]` | –í–≤–µ–¥–µ–Ω–∞ —Å—É–º–º–∞ | `User 120962578 entered amount for Model A: 150.00` |
| `[SAVE]` | –ù–∞—á–∞—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–º–µ–Ω—ã | `Saving shift for user 120962578` |
| `[SAVED]` | –°–º–µ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ | `Shift 42 created for user 120962578 \| Clock in: ... \| Products: Model A=150.00` |
| `[EDIT]` | –ù–∞—á–∞—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | `User 120962578 started shift editing` |
| `[UPDATED]` | –ü–æ–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ | `Shift 42 Clock in updated to 2025/10/15 10:00:00 by user 120962578` |
| `[ERROR]` | –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ | `Failed to create shift for user 120962578: Connection error` |

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø–∏—Å–µ–π:**
```log
2025-10-15 20:40:46 - handlers - INFO - [START] User 120962578 (@StepunR) started bot
2025-10-15 20:40:49 - handlers - INFO - [EDIT] User 120962578 started shift editing
2025-10-15 20:40:52 - handlers - INFO - [EDIT] User 120962578 viewing 2 shifts
2025-10-15 20:41:37 - handlers - INFO - [TIME_IN] User 120962578 selected Clock in: 2025/10/15 01:00:00
```

**–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
- `INFO`: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–≤—ã–±–æ—Ä –æ–ø—Ü–∏–π, —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- `WARNING`: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–ø–æ–ø—ã—Ç–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—Ä–µ–º—è)
- `ERROR`: –û—à–∏–±–∫–∏ (–ø—Ä–æ–±–ª–µ–º—ã —Å Google Sheets, —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏)
- `DEBUG`: –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:**
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫
tail -n 50 bot.log

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f bot.log

# –ü–æ–∏—Å–∫ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É
grep "\[ERROR\]" bot.log
grep "\[SAVED\]" bot.log

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
grep "User 120962578" bot.log
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ–Ω—ã —Å –æ–¥–Ω–∏–º –ø—Ä–æ–¥—É–∫—Ç–æ–º
2. –°–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ–Ω—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
3. –ü–æ–ø—ã—Ç–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç –ø—Ä–æ–¥—É–∫—Ç–∞
4. –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
5. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Clock in
6. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Clock out
7. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Total sales
8. –í–∞–ª–∏–¥–∞—Ü–∏—è Clock out > Clock in

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. `.env` –∏ `google_sheets_credentials.json` –≤ `.gitignore`
2. –¢–æ–∫–µ–Ω—ã –Ω–µ –≤ –∫–æ–¥–µ
3. Service Account —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å BOT_TOKEN
2. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å SPREADSHEET_ID
3. –î–æ—Å—Ç—É–ø Service Account –∫ —Ç–∞–±–ª–∏—Ü–µ
4. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å google_sheets_credentials.json
5. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:**
- [python-telegram-bot docs](https://docs.python-telegram-bot.org/)
- [gspread docs](https://docs.gspread.org/)
- [Google Sheets API](https://developers.google.com/sheets/api)

---

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω–∞—è
- [README.md](../README.md) - –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –∏ –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- [CLAUDE.md](CLAUDE.md) - –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç (–ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- [TEST_SCENARIOS.md](TEST_SCENARIOS.md) - –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (28 —Ç–µ—Å—Ç–æ–≤)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [tests/README.md](../tests/README.md) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
- [tests/QUICK_START.md](../tests/QUICK_START.md) - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [README_TESTING.md](README_TESTING.md) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### –ê–Ω–∞–ª–∏–∑ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ANALYSIS_AND_PLAN.md](ANALYSIS_AND_PLAN.md) - –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏ –ø–ª–∞–Ω
- [IMPROVEMENTS_ANALYSIS.md](IMPROVEMENTS_ANALYSIS.md) - –ê–Ω–∞–ª–∏–∑ —É–ª—É—á—à–µ–Ω–∏–π
- [TZ2_ANALYSIS.md](TZ2_ANALYSIS.md) - –ê–Ω–∞–ª–∏–∑ –¢–ó v2
- [MIGRATION_SUMMARY.md](MIGRATION_SUMMARY.md) - –°–≤–æ–¥–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤

---

## üìä –°—Ç–∞—Ç—É—Å –ü—Ä–æ–µ–∫—Ç–∞

**–í–µ—Ä—Å–∏—è:** 2.0
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-15
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-01
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ–Ω —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 3 —Å–º–µ–Ω
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–≥–æ–≤ (6 —É—Ä–æ–≤–Ω–µ–π)
- ‚úÖ –ë–æ–Ω—É—Å—ã –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (7 —Ç–∏–ø–æ–≤)
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–≤–∫–∞ –∫–æ–º–∏—Å—Å–∏–∏
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–Ω–≥–∞—Ö

**–°–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ–Ω—ã:**
- ‚úÖ –í—ã–±–æ—Ä –¥–∞—Ç—ã (Server date / Server date -1)
- ‚úÖ –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è (AM/PM –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ 3√ó4)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ (Clock out > Clock in)
- ‚úÖ –í—ã–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ –í–≤–æ–¥ —Å—É–º–º —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚úÖ –†–∞—Å—á–µ—Ç: Total sales, Net sales, Commission %, Total made
- ‚úÖ –£—á–µ—Ç –±–æ–Ω—É—Å–æ–≤ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ Total made
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–Ω–≥–æ–≤
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–≤—ã—à–µ–Ω–∏–∏/–ø–æ–Ω–∏–∂–µ–Ω–∏–∏ —Ä–∞–Ω–≥–∞
- ‚úÖ –í—ã–¥–∞—á–∞ —Å–ª—É—á–∞–π–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤
- ‚úÖ –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç ID
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Google Sheets

**–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–º–µ–Ω—ã:**
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–º–µ–Ω (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ Date)
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Clock in (–¥–∞—Ç–∞ –∏–∑ –ø–æ–ª—è Date –∑–∞–ø–∏—Å–∏)
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Clock out (–¥–∞—Ç–∞ –∏–∑ –ø–æ–ª—è Date –∑–∞–ø–∏—Å–∏)
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Total sales —Å –ø–æ–ª–Ω—ã–º –ø–µ—Ä–µ—Å—á–µ—Ç–æ–º
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–Ω–≥–æ–≤ –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º—ã—Ö –ø–æ–ª–µ–π

**–°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–≥–æ–≤:**
- ‚úÖ 6 —Ä–∞–Ω–≥–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Å—è—á–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ/–ø–æ–Ω–∏–∂–µ–Ω–∏–µ
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–º–µ–Ω–µ —Ä–∞–Ω–≥–∞
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–∞–Ω–≥–æ–≤ (Previous Rank)
- ‚úÖ –§–ª–∞–≥ Notified –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–ë–æ–Ω—É—Å—ã:**
- ‚úÖ flat_immediate - –∫ —Ç–µ–∫—É—â–µ–π —Å–º–µ–Ω–µ
- ‚úÖ percent_next - —É–≤–µ–ª–∏—á–µ–Ω–∏–µ % –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å–º–µ–Ω–µ
- ‚úÖ double_commission - —É–¥–≤–æ–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–∏
- ‚úÖ percent_prev - –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å–º–µ–Ω—ã –¥—Ä—É–≥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- ‚úÖ percent_all - –æ—Ç –≤—Å–µ—Ö —Å–º–µ–Ω –∑–∞ –¥–µ–Ω—å
- ‚úÖ paid_day_off - –æ–ø–ª–∞—á–∏–≤–∞–µ–º—ã–π –≤—ã—Ö–æ–¥–Ω–æ–π
- ‚úÖ telegram_premium - –ø–æ–¥–ø–∏—Å–∫–∞

**–ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ UX:**
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
- ‚úÖ –°—Ç–µ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- ‚úÖ –≠–º–æ–¥–∑–∏ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ –§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã: YYYY/MM/DD HH:MM:SS
- ‚úÖ –¢–∞–π–º–∑–æ–Ω–∞: America/New_York (UTC-5 + DST)
- ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–æ—Ç–∞—Ü–∏–µ–π (10MB, 5 backups)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Google Sheets
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (2/28, 7%)
- ‚úÖ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó:** 100% + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
